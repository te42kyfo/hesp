#include "guile_opencl.h"

scm_t_bits guile_opencl_tag; // visible in guile_opencl.h

void init_guile_opencl() {
    guile_opencl_tag = scm_make_smob_type("OpenCL", sizeof(void *));
    scm_set_smob_print(guile_opencl_tag, print_guile_opencl);

    scm_c_define_gsubr("cl-platform?",      1, 0, 0, scm_platform_p);
    scm_c_define_gsubr("cl-device?",        1, 0, 0, scm_device_p);
    scm_c_define_gsubr("cl-context?",       1, 0, 0, scm_context_p);
    scm_c_define_gsubr("cl-command-queue?", 1, 0, 0, scm_command_queue_p);
    scm_c_define_gsubr("cl-mem?",           1, 0, 0, scm_mem_p);
    scm_c_define_gsubr("cl-program?",       1, 0, 0, scm_program_p);
    scm_c_define_gsubr("cl-kernel?",        1, 0, 0, scm_kernel_p);
    scm_c_define_gsubr("cl-event?",         1, 0, 0, scm_event_p);
    scm_c_define_gsubr("cl-sampler?",       1, 0, 0, scm_sampler_p);

    scm_c_define_gsubr("cl-platform-info",      2, 0, 0, scm_get_platform_info);
    scm_c_define_gsubr("cl-device-info",        2, 0, 0, scm_get_device_info);
    scm_c_define_gsubr("cl-context-info",       2, 0, 0, scm_get_context_info);
    scm_c_define_gsubr("cl-command-info",       2, 0, 0, scm_get_command_queue_info);
    scm_c_define_gsubr("cl-mem-info",           2, 0, 0, scm_get_mem_info);
    scm_c_define_gsubr("cl-program-info",       2, 0, 0, scm_get_program_info);
    scm_c_define_gsubr("cl-kernel-info",        2, 0, 0, scm_get_kernel_info);
    //scm_c_define_gsubr("cl-event-info",         2, 0, 0, scm_get_event_info);
    scm_c_define_gsubr("cl-sampler-info",       2, 0, 0, scm_get_sampler_info);
    scm_c_define_gsubr("cl-program-build-info", 3, 0, 0, scm_get_sampler_info);
    scm_c_define_gsubr("cl-work-group-info",    3, 0, 0, scm_get_sampler_info);
    scm_c_define_gsubr("cl-info",               1, 1, 0, scm_get_info);

    scm_c_define_gsubr("cl-get-platforms",  0, 0, 0, scm_get_platforms);
    scm_c_define_gsubr("cl-get-devices",    1, 0, 0, scm_get_devices);
    scm_c_define_gsubr("cl-make-context",   0, 0, 1, scm_make_context);
    scm_c_define_gsubr("cl-make-queue",     2, 0, 0, scm_make_queue);

    /* export of OpenCL constants */
#define DEFINE_CONSTANT(NAME) scm_c_define(#NAME, scm_from_uint32(NAME))
    DEFINE_CONSTANT( CL_VERSION_1_0 );
    DEFINE_CONSTANT( CL_VERSION_1_1 );
    DEFINE_CONSTANT( CL_FALSE );
    DEFINE_CONSTANT( CL_TRUE );
    DEFINE_CONSTANT( CL_PLATFORM_PROFILE );
    DEFINE_CONSTANT( CL_PLATFORM_VERSION );
    DEFINE_CONSTANT( CL_PLATFORM_NAME );
    DEFINE_CONSTANT( CL_PLATFORM_VENDOR );
    DEFINE_CONSTANT( CL_PLATFORM_EXTENSIONS );
    DEFINE_CONSTANT( CL_DEVICE_TYPE_DEFAULT );
    DEFINE_CONSTANT( CL_DEVICE_TYPE_CPU );
    DEFINE_CONSTANT( CL_DEVICE_TYPE_GPU );
    DEFINE_CONSTANT( CL_DEVICE_TYPE_ACCELERATOR );
    DEFINE_CONSTANT( CL_DEVICE_TYPE_ALL );
    DEFINE_CONSTANT( CL_DEVICE_TYPE );
    DEFINE_CONSTANT( CL_DEVICE_VENDOR_ID );
    DEFINE_CONSTANT( CL_DEVICE_MAX_COMPUTE_UNITS );
    DEFINE_CONSTANT( CL_DEVICE_MAX_WORK_ITEM_DIMENSIONS );
    DEFINE_CONSTANT( CL_DEVICE_MAX_WORK_GROUP_SIZE );
    DEFINE_CONSTANT( CL_DEVICE_MAX_WORK_ITEM_SIZES );
    DEFINE_CONSTANT( CL_DEVICE_PREFERRED_VECTOR_WIDTH_CHAR );
    DEFINE_CONSTANT( CL_DEVICE_PREFERRED_VECTOR_WIDTH_SHORT );
    DEFINE_CONSTANT( CL_DEVICE_PREFERRED_VECTOR_WIDTH_INT );
    DEFINE_CONSTANT( CL_DEVICE_PREFERRED_VECTOR_WIDTH_LONG );
    DEFINE_CONSTANT( CL_DEVICE_PREFERRED_VECTOR_WIDTH_FLOAT );
    DEFINE_CONSTANT( CL_DEVICE_PREFERRED_VECTOR_WIDTH_DOUBLE );
    DEFINE_CONSTANT( CL_DEVICE_MAX_CLOCK_FREQUENCY );
    DEFINE_CONSTANT( CL_DEVICE_ADDRESS_BITS );
    DEFINE_CONSTANT( CL_DEVICE_MAX_READ_IMAGE_ARGS );
    DEFINE_CONSTANT( CL_DEVICE_MAX_WRITE_IMAGE_ARGS );
    DEFINE_CONSTANT( CL_DEVICE_MAX_MEM_ALLOC_SIZE );
    DEFINE_CONSTANT( CL_DEVICE_IMAGE2D_MAX_WIDTH );
    DEFINE_CONSTANT( CL_DEVICE_IMAGE2D_MAX_HEIGHT );
    DEFINE_CONSTANT( CL_DEVICE_IMAGE3D_MAX_WIDTH );
    DEFINE_CONSTANT( CL_DEVICE_IMAGE3D_MAX_HEIGHT );
    DEFINE_CONSTANT( CL_DEVICE_IMAGE3D_MAX_DEPTH );
    DEFINE_CONSTANT( CL_DEVICE_IMAGE_SUPPORT );
    DEFINE_CONSTANT( CL_DEVICE_MAX_PARAMETER_SIZE );
    DEFINE_CONSTANT( CL_DEVICE_MAX_SAMPLERS );
    DEFINE_CONSTANT( CL_DEVICE_MEM_BASE_ADDR_ALIGN );
    DEFINE_CONSTANT( CL_DEVICE_MIN_DATA_TYPE_ALIGN_SIZE );
    DEFINE_CONSTANT( CL_DEVICE_SINGLE_FP_CONFIG );
    DEFINE_CONSTANT( CL_DEVICE_GLOBAL_MEM_CACHE_TYPE );
    DEFINE_CONSTANT( CL_DEVICE_GLOBAL_MEM_CACHELINE_SIZE );
    DEFINE_CONSTANT( CL_DEVICE_GLOBAL_MEM_CACHE_SIZE );
    DEFINE_CONSTANT( CL_DEVICE_GLOBAL_MEM_SIZE );
    DEFINE_CONSTANT( CL_DEVICE_MAX_CONSTANT_BUFFER_SIZE );
    DEFINE_CONSTANT( CL_DEVICE_MAX_CONSTANT_ARGS );
    DEFINE_CONSTANT( CL_DEVICE_LOCAL_MEM_TYPE );
    DEFINE_CONSTANT( CL_DEVICE_LOCAL_MEM_SIZE );
    DEFINE_CONSTANT( CL_DEVICE_ERROR_CORRECTION_SUPPORT );
    DEFINE_CONSTANT( CL_DEVICE_PROFILING_TIMER_RESOLUTION );
    DEFINE_CONSTANT( CL_DEVICE_ENDIAN_LITTLE );
    DEFINE_CONSTANT( CL_DEVICE_AVAILABLE );
    DEFINE_CONSTANT( CL_DEVICE_COMPILER_AVAILABLE );
    DEFINE_CONSTANT( CL_DEVICE_EXECUTION_CAPABILITIES );
    DEFINE_CONSTANT( CL_DEVICE_QUEUE_PROPERTIES );
    DEFINE_CONSTANT( CL_DEVICE_NAME );
    DEFINE_CONSTANT( CL_DEVICE_VENDOR );
    DEFINE_CONSTANT( CL_DRIVER_VERSION );
    DEFINE_CONSTANT( CL_DEVICE_PROFILE );
    DEFINE_CONSTANT( CL_DEVICE_VERSION );
    DEFINE_CONSTANT( CL_DEVICE_EXTENSIONS );
    DEFINE_CONSTANT( CL_DEVICE_PLATFORM );
    DEFINE_CONSTANT( CL_DEVICE_PREFERRED_VECTOR_WIDTH_HALF );
    DEFINE_CONSTANT( CL_DEVICE_HOST_UNIFIED_MEMORY );
    DEFINE_CONSTANT( CL_DEVICE_NATIVE_VECTOR_WIDTH_CHAR );
    DEFINE_CONSTANT( CL_DEVICE_NATIVE_VECTOR_WIDTH_SHORT );
    DEFINE_CONSTANT( CL_DEVICE_NATIVE_VECTOR_WIDTH_INT );
    DEFINE_CONSTANT( CL_DEVICE_NATIVE_VECTOR_WIDTH_LONG );
    DEFINE_CONSTANT( CL_DEVICE_NATIVE_VECTOR_WIDTH_FLOAT );
    DEFINE_CONSTANT( CL_DEVICE_NATIVE_VECTOR_WIDTH_DOUBLE );
    DEFINE_CONSTANT( CL_DEVICE_NATIVE_VECTOR_WIDTH_HALF );
    DEFINE_CONSTANT( CL_DEVICE_OPENCL_C_VERSION );
    DEFINE_CONSTANT( CL_FP_DENORM );
    DEFINE_CONSTANT( CL_FP_INF_NAN );
    DEFINE_CONSTANT( CL_FP_ROUND_TO_NEAREST );
    DEFINE_CONSTANT( CL_FP_ROUND_TO_ZERO );
    DEFINE_CONSTANT( CL_FP_ROUND_TO_INF );
    DEFINE_CONSTANT( CL_FP_FMA );
    DEFINE_CONSTANT( CL_FP_SOFT_FLOAT );
    DEFINE_CONSTANT( CL_NONE );
    DEFINE_CONSTANT( CL_READ_ONLY_CACHE );
    DEFINE_CONSTANT( CL_READ_WRITE_CACHE );
    DEFINE_CONSTANT( CL_LOCAL );
    DEFINE_CONSTANT( CL_GLOBAL );
    DEFINE_CONSTANT( CL_EXEC_KERNEL );
    DEFINE_CONSTANT( CL_EXEC_NATIVE_KERNEL );
    DEFINE_CONSTANT( CL_QUEUE_OUT_OF_ORDER_EXEC_MODE_ENABLE );
    DEFINE_CONSTANT( CL_QUEUE_PROFILING_ENABLE );
    DEFINE_CONSTANT( CL_CONTEXT_REFERENCE_COUNT );
    DEFINE_CONSTANT( CL_CONTEXT_DEVICES );
    DEFINE_CONSTANT( CL_CONTEXT_PROPERTIES );
    DEFINE_CONSTANT( CL_CONTEXT_NUM_DEVICES );
    DEFINE_CONSTANT( CL_CONTEXT_PLATFORM );
    DEFINE_CONSTANT( CL_QUEUE_CONTEXT );
    DEFINE_CONSTANT( CL_QUEUE_DEVICE );
    DEFINE_CONSTANT( CL_QUEUE_REFERENCE_COUNT );
    DEFINE_CONSTANT( CL_QUEUE_PROPERTIES );
    DEFINE_CONSTANT( CL_MEM_READ_WRITE );
    DEFINE_CONSTANT( CL_MEM_WRITE_ONLY );
    DEFINE_CONSTANT( CL_MEM_READ_ONLY );
    DEFINE_CONSTANT( CL_MEM_USE_HOST_PTR );
    DEFINE_CONSTANT( CL_MEM_ALLOC_HOST_PTR );
    DEFINE_CONSTANT( CL_MEM_COPY_HOST_PTR );
    DEFINE_CONSTANT( CL_R );
    DEFINE_CONSTANT( CL_A );
    DEFINE_CONSTANT( CL_RG );
    DEFINE_CONSTANT( CL_RA );
    DEFINE_CONSTANT( CL_RGB );
    DEFINE_CONSTANT( CL_RGBA );
    DEFINE_CONSTANT( CL_BGRA );
    DEFINE_CONSTANT( CL_ARGB );
    DEFINE_CONSTANT( CL_INTENSITY );
    DEFINE_CONSTANT( CL_LUMINANCE );
    DEFINE_CONSTANT( CL_Rx );
    DEFINE_CONSTANT( CL_RGx );
    DEFINE_CONSTANT( CL_RGBx );
    DEFINE_CONSTANT( CL_SNORM_INT8 );
    DEFINE_CONSTANT( CL_SNORM_INT16 );
    DEFINE_CONSTANT( CL_UNORM_INT8 );
    DEFINE_CONSTANT( CL_UNORM_INT16 );
    DEFINE_CONSTANT( CL_UNORM_SHORT_565 );
    DEFINE_CONSTANT( CL_UNORM_SHORT_555 );
    DEFINE_CONSTANT( CL_UNORM_INT_101010 );
    DEFINE_CONSTANT( CL_SIGNED_INT8 );
    DEFINE_CONSTANT( CL_SIGNED_INT16 );
    DEFINE_CONSTANT( CL_SIGNED_INT32 );
    DEFINE_CONSTANT( CL_UNSIGNED_INT8 );
    DEFINE_CONSTANT( CL_UNSIGNED_INT16 );
    DEFINE_CONSTANT( CL_UNSIGNED_INT32 );
    DEFINE_CONSTANT( CL_HALF_FLOAT );
    DEFINE_CONSTANT( CL_FLOAT );
    DEFINE_CONSTANT( CL_MEM_OBJECT_BUFFER );
    DEFINE_CONSTANT( CL_MEM_OBJECT_IMAGE2D );
    DEFINE_CONSTANT( CL_MEM_OBJECT_IMAGE3D );
    DEFINE_CONSTANT( CL_MEM_TYPE );
    DEFINE_CONSTANT( CL_MEM_FLAGS );
    DEFINE_CONSTANT( CL_MEM_SIZE );
    DEFINE_CONSTANT( CL_MEM_HOST_PTR );
    DEFINE_CONSTANT( CL_MEM_MAP_COUNT );
    DEFINE_CONSTANT( CL_MEM_REFERENCE_COUNT );
    DEFINE_CONSTANT( CL_MEM_CONTEXT );
    DEFINE_CONSTANT( CL_MEM_ASSOCIATED_MEMOBJECT );
    DEFINE_CONSTANT( CL_MEM_OFFSET );
    DEFINE_CONSTANT( CL_IMAGE_FORMAT );
    DEFINE_CONSTANT( CL_IMAGE_ELEMENT_SIZE );
    DEFINE_CONSTANT( CL_IMAGE_ROW_PITCH );
    DEFINE_CONSTANT( CL_IMAGE_SLICE_PITCH );
    DEFINE_CONSTANT( CL_IMAGE_WIDTH );
    DEFINE_CONSTANT( CL_IMAGE_HEIGHT );
    DEFINE_CONSTANT( CL_IMAGE_DEPTH );
    DEFINE_CONSTANT( CL_ADDRESS_NONE );
    DEFINE_CONSTANT( CL_ADDRESS_CLAMP_TO_EDGE );
    DEFINE_CONSTANT( CL_ADDRESS_CLAMP );
    DEFINE_CONSTANT( CL_ADDRESS_REPEAT );
    DEFINE_CONSTANT( CL_ADDRESS_MIRRORED_REPEAT );
    DEFINE_CONSTANT( CL_FILTER_NEAREST );
    DEFINE_CONSTANT( CL_FILTER_LINEAR );
    DEFINE_CONSTANT( CL_SAMPLER_REFERENCE_COUNT );
    DEFINE_CONSTANT( CL_SAMPLER_CONTEXT );
    DEFINE_CONSTANT( CL_SAMPLER_NORMALIZED_COORDS );
    DEFINE_CONSTANT( CL_SAMPLER_ADDRESSING_MODE );
    DEFINE_CONSTANT( CL_SAMPLER_FILTER_MODE );
    DEFINE_CONSTANT( CL_MAP_READ );
    DEFINE_CONSTANT( CL_MAP_WRITE );
    DEFINE_CONSTANT( CL_PROGRAM_REFERENCE_COUNT );
    DEFINE_CONSTANT( CL_PROGRAM_CONTEXT );
    DEFINE_CONSTANT( CL_PROGRAM_NUM_DEVICES );
    DEFINE_CONSTANT( CL_PROGRAM_DEVICES );
    DEFINE_CONSTANT( CL_PROGRAM_SOURCE );
    DEFINE_CONSTANT( CL_PROGRAM_BINARY_SIZES );
    DEFINE_CONSTANT( CL_PROGRAM_BINARIES );
    DEFINE_CONSTANT( CL_PROGRAM_BUILD_STATUS );
    DEFINE_CONSTANT( CL_PROGRAM_BUILD_OPTIONS );
    DEFINE_CONSTANT( CL_PROGRAM_BUILD_LOG );
    DEFINE_CONSTANT( CL_BUILD_SUCCESS );
    DEFINE_CONSTANT( CL_BUILD_NONE );
    DEFINE_CONSTANT( CL_BUILD_ERROR );
    DEFINE_CONSTANT( CL_BUILD_IN_PROGRESS );
    DEFINE_CONSTANT( CL_KERNEL_FUNCTION_NAME );
    DEFINE_CONSTANT( CL_KERNEL_NUM_ARGS );
    DEFINE_CONSTANT( CL_KERNEL_REFERENCE_COUNT );
    DEFINE_CONSTANT( CL_KERNEL_CONTEXT );
    DEFINE_CONSTANT( CL_KERNEL_PROGRAM );
    DEFINE_CONSTANT( CL_KERNEL_WORK_GROUP_SIZE );
    DEFINE_CONSTANT( CL_KERNEL_COMPILE_WORK_GROUP_SIZE );
    DEFINE_CONSTANT( CL_KERNEL_LOCAL_MEM_SIZE );
    DEFINE_CONSTANT( CL_KERNEL_PREFERRED_WORK_GROUP_SIZE_MULTIPLE );
    DEFINE_CONSTANT( CL_KERNEL_PRIVATE_MEM_SIZE );
    DEFINE_CONSTANT( CL_EVENT_COMMAND_QUEUE );
    DEFINE_CONSTANT( CL_EVENT_COMMAND_TYPE );
    DEFINE_CONSTANT( CL_EVENT_REFERENCE_COUNT );
    DEFINE_CONSTANT( CL_EVENT_COMMAND_EXECUTION_STATUS );
    DEFINE_CONSTANT( CL_EVENT_CONTEXT );
    DEFINE_CONSTANT( CL_COMMAND_NDRANGE_KERNEL );
    DEFINE_CONSTANT( CL_COMMAND_TASK );
    DEFINE_CONSTANT( CL_COMMAND_NATIVE_KERNEL );
    DEFINE_CONSTANT( CL_COMMAND_READ_BUFFER );
    DEFINE_CONSTANT( CL_COMMAND_WRITE_BUFFER );
    DEFINE_CONSTANT( CL_COMMAND_COPY_BUFFER );
    DEFINE_CONSTANT( CL_COMMAND_READ_IMAGE );
    DEFINE_CONSTANT( CL_COMMAND_WRITE_IMAGE );
    DEFINE_CONSTANT( CL_COMMAND_COPY_IMAGE );
    DEFINE_CONSTANT( CL_COMMAND_COPY_IMAGE_TO_BUFFER );
    DEFINE_CONSTANT( CL_COMMAND_COPY_BUFFER_TO_IMAGE );
    DEFINE_CONSTANT( CL_COMMAND_MAP_BUFFER );
    DEFINE_CONSTANT( CL_COMMAND_MAP_IMAGE );
    DEFINE_CONSTANT( CL_COMMAND_UNMAP_MEM_OBJECT );
    DEFINE_CONSTANT( CL_COMMAND_MARKER );
    DEFINE_CONSTANT( CL_COMMAND_ACQUIRE_GL_OBJECTS );
    DEFINE_CONSTANT( CL_COMMAND_RELEASE_GL_OBJECTS );
    DEFINE_CONSTANT( CL_COMMAND_READ_BUFFER_RECT );
    DEFINE_CONSTANT( CL_COMMAND_WRITE_BUFFER_RECT );
    DEFINE_CONSTANT( CL_COMMAND_COPY_BUFFER_RECT );
    DEFINE_CONSTANT( CL_COMMAND_USER );
    DEFINE_CONSTANT( CL_COMPLETE );
    DEFINE_CONSTANT( CL_RUNNING );
    DEFINE_CONSTANT( CL_SUBMITTED );
    DEFINE_CONSTANT( CL_QUEUED );
    DEFINE_CONSTANT( CL_BUFFER_CREATE_TYPE_REGION );
    DEFINE_CONSTANT( CL_PROFILING_COMMAND_QUEUED );
    DEFINE_CONSTANT( CL_PROFILING_COMMAND_SUBMIT );
    DEFINE_CONSTANT( CL_PROFILING_COMMAND_START );
    DEFINE_CONSTANT( CL_PROFILING_COMMAND_END );
}
